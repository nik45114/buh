# ‚úÖ –§–∞–∑–∞ 7: –ß–µ–∫–∏ –∏ –ü–æ–¥–æ—Ç—á–µ—Ç—ã - –ó–ê–í–ï–†–®–ï–ù–ê

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ —á–µ–∫–æ–≤ (QR-–∫–æ–¥ –§–ù–°)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–æ–≤ —Å —á–µ–∫–æ–≤
- –ó–∞–ø—Ä–æ—Å –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫ API –§–ù–°
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: —Ç–æ–≤–∞—Ä—ã, –ø—Ä–æ–¥–∞–≤–µ—Ü, —Å—É–º–º–∞, –ù–î–°
- –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ä–∞—Å—Ö–æ–¥–∞

### 2. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–æ—Ç—á–µ—Ç–Ω—ã—Ö —Å—É–º–º
- –í—ã–¥–∞—á–∞ –Ω–∞–ª–∏—á–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –ø–æ–¥ –æ—Ç—á–µ—Ç
- –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ –æ—Ç—á–µ—Ç–∞ (–ø–æ –¢–ö –†–§ - 3 –¥–Ω—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ù–î–§–õ –ø—Ä–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–µ
- –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏ –ø–æ–ª–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

### 3. API –¥–ª—è Bot_Claude
**3 –Ω–æ–≤—ã—Ö endpoint'–∞:**

#### `/api/receipt` - –ü—Ä–∏–µ–º —á–µ–∫–∞
```bash
curl -X POST http://64.188.83.12:8000/api/receipt \
  -H "X-API-Key: f632d94a0815ca53930f2168e5cf1a741ce3e67841e5786f696c64b8d8e6895c" \
  -H "Content-Type: application/json" \
  -d '{
    "qr_data": "t=20240115T1530&s=1500.00&fn=9999078900004792&i=12345&fp=3522207165&n=1",
    "category": "–ö–∞–Ω—Ü—Ç–æ–≤–∞—Ä—ã",
    "notes": "–ü–æ–∫—É–ø–∫–∞ –±—É–º–∞–≥–∏"
  }'
```

#### `/api/cash-withdrawal` - –í—ã–¥–∞—á–∞ –Ω–∞–ª–∏—á–∫–∏
```bash
curl -X POST http://64.188.83.12:8000/api/cash-withdrawal \
  -H "X-API-Key: f632d94a0815ca53930f2168e5cf1a741ce3e67841e5786f696c64b8d8e6895c" \
  -H "Content-Type: application/json" \
  -d '{
    "employee_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
    "amount": 5000,
    "purpose": "–ó–∞–∫—É–ø–∫–∞ –≤–æ–¥—ã –∏ –∫–∞–Ω—Ü—Ç–æ–≤–∞—Ä–æ–≤",
    "report_deadline_days": 3
  }'
```

#### `/api/accountable-report` - –û—Ç—á–µ—Ç –ø–æ –ø–æ–¥–æ—Ç—á–µ—Ç—É
```bash
curl -X POST http://64.188.83.12:8000/api/accountable-report \
  -H "X-API-Key: f632d94a0815ca53930f2168e5cf1a741ce3e67841e5786f696c64b8d8e6895c" \
  -H "Content-Type: application/json" \
  -d '{
    "accountable_id": 5,
    "receipts": [
      "t=20240115T1530&s=1500.00&fn=9999078900004792&i=12345&fp=3522207165&n=1",
      "t=20240115T1600&s=3500.00&fn=9999078900004792&i=12346&fp=3522207166&n=1"
    ]
  }'
```

### 4. –ú–æ–¥–µ–ª–∏ –ë–î

**Accountable** - –ø–æ–¥–æ—Ç—á–µ—Ç–Ω—ã–µ —Å—É–º–º—ã
- employee_id, amount_issued, amount_reported
- status: pending/partial/reported/overdue/taxed
- report_deadline - –∫–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤
- –ê–≤—Ç–æ—Å–≤—è–∑—å —Å —á–µ–∫–∞–º–∏

**Receipt** - —á–µ–∫–∏ –§–ù–°
- fiscal_sign, fiscal_document, fiscal_storage
- seller_name, seller_inn, seller_address
- items (JSON) - —Ç–æ–≤–∞—Ä—ã
- total_amount, vat_amount
- –°–≤—è–∑—å —Å Transaction –∏ Accountable

**BankTransaction** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –±–∞–Ω–∫–æ–≤
- bank: tochka/alpha/tinkoff
- operation_date, amount, purpose
- category (GPT-4 –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç)
- processing_status
- –°–≤—è–∑—å —Å Transaction

**TaxCalculation** - —Ä–∞—Å—á–µ—Ç –Ω–∞–ª–æ–≥–æ–≤
- –£–°–ù –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º (2% –°–∞—Ö–∞, 6% –æ–±–æ—Å–æ–±–∫–∏)
- year, quarter, tax_type, region
- tax_base, tax_amount, amount_due
- payment_deadline, status

---

## üìã –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bot_Claude

**–§–∞–π–ª:** [BOT_CLAUDE_API_INTEGRATION.md](BOT_CLAUDE_API_INTEGRATION.md)

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `accounting_integration.py` –≤ `/opt/club_assistant/`
2. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

**–ì–æ—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-—á–µ–∫–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é
- –ö–æ–º–∞–Ω–¥–∞ `/cash 5000 –í–æ–¥–∞` ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–¥–æ—Ç—á–µ—Ç–∞
- –ö–æ–º–∞–Ω–¥–∞ `/report 5` ‚Üí –æ—Ç—á–µ—Ç –ø–æ –ø–æ–¥–æ—Ç—á–µ—Ç—É —Å —á–µ–∫–∞–º–∏

---

## üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü:**

```bash
cd /opt/accounting-bot
alembic revision --autogenerate -m "Add accountable and receipt tables"
alembic upgrade head
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –ü—Ä–∏–µ–º —á–µ–∫–∞
```bash
curl -X POST http://64.188.83.12:8000/api/receipt \
  -H "X-API-Key: f632d94a0815ca53930f2168e5cf1a741ce3e67841e5786f696c64b8d8e6895c" \
  -H "Content-Type: application/json" \
  -d '{"qr_data": "t=20240115T1530&s=1500.00&fn=9999078900004792&i=12345&fp=3522207165&n=1"}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "Receipt processed successfully",
  "data": {
    "receipt_id": 1,
    "transaction_id": 123,
    "total_amount": 1500.0,
    "seller": "–û–û–û –ú–∞–≥–∞–∑–∏–Ω",
    "fns_url": "https://check.ofd.ru/rec/..."
  }
}
```

### –¢–µ—Å—Ç 2: –í—ã–¥–∞—á–∞ –Ω–∞–ª–∏—á–∫–∏
```bash
curl -X POST http://64.188.83.12:8000/api/cash-withdrawal \
  -H "X-API-Key: f632d94a0815ca53930f2168e5cf1a741ce3e67841e5786f696c64b8d8e6895c" \
  -H "Content-Type: application/json" \
  -d '{"employee_name": "Test Employee", "amount": 5000, "purpose": "Test"}'
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Bot_Claude –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º —Å –±–∞–Ω–∫–∞–º–∏** (–∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –≤—ã–ø–∏—Å–æ–∫)
2. **–°–ë–ò–° –∞–≤—Ç–æ–æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å** (—Å–¥–∞—á–∞ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–π)
3. **–ö–∞–¥—Ä–æ–≤—ã–π —É—á–µ—Ç** (–ø—Ä–∏–µ–º/—É–≤–æ–ª—å–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞)
4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** (scheduler, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [BOT_CLAUDE_API_INTEGRATION.md](BOT_CLAUDE_API_INTEGRATION.md) - –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- [SBIS_OFD_SETUP.md](SBIS_OFD_SETUP.md) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –°–ë–ò–° –û–§–î
- [MANUAL_CHECK_GUIDE.md](MANUAL_CHECK_GUIDE.md) - —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ–Ω

---

## üí° –ö–ª—é—á–µ–≤—ã–µ —Ñ–∏—á–∏

‚úÖ **–ó–∞–∫–æ–Ω–Ω–æ—Å—Ç—å** - –≤—Å—ë –ø–æ –¢–ö –†–§, –ù–ö –†–§, –§–ó-400
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –º–∏–Ω–∏–º—É–º —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –≥–æ—Ç–æ–≤—ã–π API –¥–ª—è Bot_Claude
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚úÖ **–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—á–µ—Ç** - –£–°–ù 2% –∏ 6% —Ä–∞–∑–¥–µ–ª—å–Ω–æ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
**GitHub:** https://github.com/nik45114/buh
**API:** http://64.188.83.12:8000
